<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>document</title>
	</head>
	<body>
		<h1>check</h1>
		<button id="btn1">click for whatsapp</button>
		<button id="btn2">click for an Unistalled app</button>
		<p id="result"></p>

		<script>
            // Add event listeners to the buttons

            document.getElementById('btn1').addEventListener('click', () => {
                handleButtonClick(
                    'whatsapp://', 
                    'https://www.whatsapp.com', // WhatsApp fallback
                    'WhatsApp is installed.', 
                    'WhatsApp is not installed.' 
                );
            });

            document.getElementById('btn2').addEventListener('click', () => {
                handleButtonClick(
                    'jfdjicjivjvfvnduvdfnvf://', // Custom scheme for an uninstalled app
                    'https://www.google.com', // Google fallback
                    'The app is installed.',  // Custom messages for the other app
                    'The app is not installed.' 
                );
            });


            const handleButtonClick = (customURL, fallbackURL, successMessage, failureMessage) => {
    const resultElement = document.getElementById('result');
    let appOpened = false; // Flag to detect if the app was opened
    let fallbackTriggered = false; // To prevent multiple fallback attempts

    // Listen for visibility change
    const handleVisibilityChange = () => {
        if (document.visibilityState === 'hidden') {
            appOpened = true; // Assume the app was opened successfully
        }
    };

    document.addEventListener('visibilitychange', handleVisibilityChange);

    // Delay iframe injection to ensure smooth processing
    setTimeout(() => {
        // Create an iframe to silently attempt the custom URL scheme
        const iframe = document.createElement('iframe');
        iframe.style.position = 'absolute';
        iframe.style.top = '-9999px';
        iframe.style.left = '-9999px';
        iframe.src = customURL; // Attempt to open the app
        document.body.appendChild(iframe);

        // Set a timeout to handle fallback
        const startTime = Date.now();
        setTimeout(() => {
            if (fallbackTriggered) return; // Prevent duplicate fallback logic

            const elapsedTime = Date.now() - startTime;

            if (appOpened || elapsedTime < 1500) {
                // App was opened successfully
                resultElement.textContent = successMessage;
            } else {
                // App was not opened, redirect to fallback
                fallbackTriggered = true;
                resultElement.textContent = failureMessage;
                window.location.href = fallbackURL; // Redirect to fallback URL
            }

            // Clean up the iframe and remove listeners
            document.body.removeChild(iframe);
            document.removeEventListener('visibilitychange', handleVisibilityChange);
        }, 1500); // Adjust timeout as necessary
    }, 100); // Add a slight delay before injecting the iframe
};
		</script>
	</body>
</html>